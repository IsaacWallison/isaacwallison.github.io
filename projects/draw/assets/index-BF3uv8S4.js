(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function u(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=u(n);fetch(n.href,i)}})();const L=(r,l)=>{const{touches:u,changedTouches:a}=r,n=u[0]??a[0],i=Math.floor(n.clientX-l.getBoundingClientRect().x),d=Math.floor(n.clientY-l.getBoundingClientRect().y);return[i,d]};window.onload=()=>{const r=document.querySelector("#canvas"),l=document.querySelector("button[data-event='undo']"),u=document.querySelector("button[data-event='redo']"),a=document.querySelector("button[data-event='save']"),n=document.querySelector("button[data-event='draw-tool']"),i=document.querySelector("button[data-event='erase-tool']"),d=document.querySelector("button[data-event='clear']"),f=document.querySelector("#line-range"),p=document.querySelector(".colors"),c=r.getContext("2d");r.width=window.innerWidth,r.height=window.innerHeight,c.lineCap="round",c.lineJoin="round";const e={deviceType:"mouse",toolSelected:"draw",isHoldingMouseButton:!1,lineColor:p.querySelector("input:checked").value,lineWidth:+f.value,colors:[],doneHistory:[],undoneHistory:[]},h={mouse:{start:"mousedown",up:"mouseup",move:"mousemove",leave:"mouseleave"},touch:{start:"touchstart",up:"touchend",move:"touchmove",leave:"touchleave"}},w=()=>{try{document.createEvent("TouchEvent"),e.deviceType="touch"}catch{e.deviceType="mouse"}},m=(t,o)=>{c.clearRect(t,o,Math.pow(c.lineWidth,2),Math.pow(c.lineWidth,2))},g=()=>{const t=e.doneHistory;for(let o=0;o<t.length;o++){c.strokeStyle=e.colors[o],c.beginPath(),c.moveTo(t[o][0],t[o][1]);for(let s=2;s<t[o].length;s+=2)c.lineTo(t[o][s],t[o][s+1]),c.stroke()}};(()=>{w(),r.addEventListener(h[e.deviceType].start,t=>{let o=0,s=0;if(e.isHoldingMouseButton=!0,c.lineWidth=e.lineWidth,c.strokeStyle=e.lineColor??c.strokeStyle,c.beginPath(),t instanceof MouseEvent&&([o,s]=[t.clientX,t.clientY]),t instanceof TouchEvent){const[v,y]=L(t,r);[o,s]=[v,y]}if(e.toolSelected==="erase"){m(o,s);return}e.doneHistory.push([o,s]),c.moveTo(o,s)}),r.addEventListener(h[e.deviceType].move,t=>{if(!e.isHoldingMouseButton)return;let o=0,s=0;if(t instanceof MouseEvent&&([o,s]=[t.clientX,t.clientY]),t instanceof TouchEvent){const[v,y]=L(t,r);[o,s]=[v,y]}if(e.toolSelected==="erase"){m(o,s);return}e.doneHistory[e.doneHistory.length-1].push(o,s),c.lineTo(o,s),c.stroke()}),r.addEventListener(h[e.deviceType].up,()=>{e.isHoldingMouseButton=!1,e.colors.push(c.strokeStyle)}),r.addEventListener(h[e.deviceType].leave,()=>{e.isHoldingMouseButton=!1}),f.addEventListener("change",t=>{t.target instanceof HTMLInputElement&&(document.querySelector(".line").style.setProperty("--line-width",`${t.target.value}px`),e.lineWidth=+t.target.value)}),p.addEventListener("click",t=>{t.target instanceof HTMLInputElement&&(e.lineColor=t.target.value)}),n.addEventListener("click",()=>{i.classList.contains("selected")&&i.classList.remove("selected"),n.classList.add("selected"),e.toolSelected="draw"}),i.addEventListener("click",()=>{n.classList.contains("selected")&&n.classList.remove("selected"),i.classList.add("selected"),e.toolSelected="erase"}),d.addEventListener("click",()=>{c.clearRect(0,0,r.width,r.height)}),a.addEventListener("click",()=>{const t=r.toDataURL(),o=document.createElement("a");o.href=t,o.download=`draw-${Date.now()}.png`,o.click()}),l.addEventListener("click",()=>{e.doneHistory.length&&(c.clearRect(0,0,r.width,r.height),e.undoneHistory.push(e.doneHistory.pop()),g())}),u.addEventListener("click",()=>{e.undoneHistory.length&&(c.clearRect(0,0,r.width,r.height),e.doneHistory.push(e.undoneHistory.pop()),g())})})()};
